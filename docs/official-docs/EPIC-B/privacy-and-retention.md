# Privacy & Retention Policy

EPIC-B — Database Core & Hardening
Version: 1.0
Status: APPROVED
Last Updated: 2026-02-13

---

# 1. Purpose

This document defines the **data privacy, retention, and deletion rules**
for third-party identity metadata stored inside Forgea.

This policy currently governs:

- GitHubAccount metadata
- GitHubRepoMapping metadata
- Any future third-party provider identity tables

This document is authoritative for:

- Storage duration
- Soft delete behavior
- Hard delete windows
- PII scope classification
- Audit expectations

All schema and implementation decisions must comply with this document.

---

# 2. Data Classification

| Field                  | Table             | Classification             | PII Level |
| ---------------------- | ----------------- | -------------------------- | --------- |
| providerId (GitHub ID) | GitHubAccount     | External Identifier        | LOW       |
| username               | GitHubAccount     | Public Profile Metadata    | MODERATE  |
| profileUrl             | GitHubAccount     | Public Profile Metadata    | MODERATE  |
| repoUrl                | GitHubRepoMapping | Public Repository Metadata | LOW       |
| providerRepoId         | GitHubRepoMapping | External Identifier        | LOW       |
| defaultBranch          | GitHubRepoMapping | Repository Metadata        | LOW       |

Notes:

- No access tokens, OAuth secrets, or private emails may be stored in these tables.
- Only public GitHub profile data is permitted.
- No historical username snapshots are retained.

---

# 3. Retention Policy

## 3.1 providerId (GitHubAccount.providerId)

- Retained as long as the Forgea user account exists.
- Deleted permanently when the Forgea user account is hard-deleted.
- Not anonymized — fully removed with account.

---

## 3.2 username / profileUrl

- Refreshed on each successful OAuth login.
- Overwritten in-place (no historical retention).
- Retained as long as the user account exists.
- Deleted during hard-delete of the Forgea account.

No archival of old usernames.

---

## 3.3 GitHubRepoMapping Rows

- Retained as long as the associated LabSession exists.
- If a LabSession is soft-deleted → mapping remains.
- If a LabSession is hard-deleted → mapping is deleted.
- Repo metadata is not independently retained beyond session lifecycle.

---

# 4. Deletion Workflow

## 4.1 User-Initiated Account Deletion

When a Forgea user deletes their account:

1. Account enters 30-day soft-delete grace period.
2. GitHubAccount rows are marked soft-deleted.
3. GitHubRepoMapping rows remain until sessions are purged.
4. After 30 days:
   - User row is permanently deleted.
   - GitHubAccount rows are permanently deleted.
   - Associated mappings tied to deleted sessions are removed.

---

# 5. Data Minimization Rules

The following are prohibited:

- Storing GitHub access tokens in database tables.
- Storing refresh tokens.
- Storing private email addresses.
- Storing organization membership lists.
- Storing commit history inside identity tables.

Only minimal identity metadata is allowed.

---

# 6. Data Update Rules

- providerId is immutable.
- username and profileUrl may update on login.
- No UPDATE/DELETE operations allowed on identity rows outside:
  - OAuth sync
  - Account deletion workflow

Audit logs must record identity deletion events.

---

# 7. Compliance Notes

- All GitHub metadata is considered Public Profile Data.
- No sensitive categories of data are collected.
- This system does not process:
  - Government IDs
  - Financial data
  - Health data

Retention aligns with:

- Standard SaaS identity lifecycle practices
- Minimal necessary data principle

---

# 8. Schema Requirements

Any Prisma models storing third-party identity metadata MUST:

- Use UUID primary keys generated by Postgres
- Avoid storing secrets
- Respect cascade rules described here
- Document deletion behavior in migration notes

---

# 9. Future Extension

If additional OAuth providers are added:

- They must follow the same retention model.
- A retention table entry must be added to this document.
- Docs Gatekeeper must review before implementation.

---

# 10. Enforcement

This document is:

- Binding for Planner decisions
- Binding for Implementer schema design
- Binding for QA verification

Violations must block merge.

---

END OF DOCUMENT
