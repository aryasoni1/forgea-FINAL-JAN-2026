# Task A6 — Prettier (Formatting Only)

Date: 2026-02-06
Status: APPROVED

---

## Goal

Deliver a canonical, version-pinned Prettier setup so formatting is deterministic across the monorepo, and CI enforces the shared rules without formatting vs. lint drift.

---

## Docs Gatekeeper Findings (Advisory)

Source: /docs/docs-gatekeeper/EPIC-A — MONOREPO & DEVELOPER TOOLING FOUNDATION/A6_Prettier (Formatting Only).md

- Official Prettier docs are required for configuration, ignores, and CLI semantics, but the gatekeeper brief currently marks the version as UNKNOWN and flags the internal docs as missing.
- Internal docs to add/extend:
  - /docs/official-docs/prettier.md (pin the chosen Prettier version, document `.prettierrc`/`.prettierignore`, and highlight editor integration hints).
  - /docs/official-docs/prettier-ci-guidelines.md (capture the CI command(s), caching/remediation expectations, and how to keep formatting deterministic).
- Master registry must record the gatekeeper brief plus the two internal docs listed above (see the "MASTER DOCS REGISTRY ACTION" section of the brief).

---

## Documentation Registry Alignment

Source: /docs/official-docs-registry.md

- Prettier is VERIFIED with a primary pin at 3.2.x and official source https://prettier.io/docs/en/index.html.
- Internal docs to link once created:
  - /docs/official-docs/prettier.md (behavior & config).
  - /docs/official-docs/prettier-ci-guidelines.md (CI enforcement).

---

## Toolchain Version Authority

Source: /docs/toolchain-versions.md

- Prettier is the formatting authority with the primary pin 3.2.x; all implementations must align with this version range (`>=3.0.0 <4.0.0`).

---

## Code Scout Facts (Constraints)

Source: /docs/code-scout/EPIC-A — MONOREPO & DEVELOPER TOOLING FOUNDATION/A6_Prettier (Formatting Only).md

- No repository-level Prettier config files (`.prettierrc`, `.prettierignore`, or `prettier.config.*`) exist today.
- The root /forgea-monorepo/package.json does not list `prettier` under dependencies or devDependencies.
- Generated artifacts reference Prettier, but no authoritative config or scripts are present.
- The orchestrator expects Docs Gatekeeper approval and a Planner-authored task document before implementation.

---

## Scope (Binding)

### In Scope

- Install Prettier 3.2.x as a workspace/dev dependency and declare the canonical formatter settings.
- Add `.prettierrc` and `.prettierignore` at the repository root (and other locations only if justified) that reference the shared style decisions.
- Update CI/automation docs and scripts so Prettier is executed deterministically (frozen installs, recommended CLI flags, remediation for drift).
- Record the new internal docs in /docs/master_docs.md per gatekeeper instructions.

### Out of Scope

- Reformatting existing files (defer to implementer or follow-up script run).
- Styling overrides inside ESLint beyond what is necessary to avoid conflicts with Prettier.
- Introducing parallel formatting tools; Prettier is the single formatting authority.

---

## Locked Decisions (Derived from Documentation)

1. Prettier must be pinned to **3.2.x** per the toolchain policy to ensure deterministic formatting behavior.

- Source: /docs/toolchain-versions.md

## Resolved Decisions (Planner)

1. CI must invoke Prettier through the root-installed binary (e.g., `pnpm -w exec prettier ...` or `pnpm -w run prettier:check`). This guarantees the repository-provided, pinned Prettier version executes deterministically versus `pnpm -w dlx` fetching a remote package at runtime.
2. `.prettierrc` and `.prettierignore` must live at the repository root with the prescribed ignore list covering generated artifacts (`.next`, `dist`, `build`, `node_modules`, `.turbo`, `.vercel`, `.cache`, `coverage`, `public/assets`, `tmp`, etc.), plus language-specific files such as `*.min.js`/`*.bundle.js`.

---

## Step-by-Step Plan (Non-Code)

1. Add Prettier 3.2.0 as a root devDependency (`forgea-monorepo/package.json`) along with `prettier:check`/`prettier:write` scripts that invoke the root binary via `pnpm -w exec`.
2. Create `/forgea-monorepo/.prettierrc` and `/forgea-monorepo/.prettierignore` with the canonical contents listed below so formatting settings and ignored artifacts are prescribed in one place.
3. Extend `/docs/official-docs/prettier.md` to describe the pinned version, point readers to the root config/ignore files, and highlight editor integration + ESLint harmonization guidance.
4. Extend `/docs/official-docs/prettier-ci-guidelines.md` to document the CI invocation (`pnpm install --frozen-lockfile` followed by `pnpm -w exec prettier --check ...`) plus remediation steps that instruct contributors to run `prettier:write` locally.
5. Append the gatekeeper-required entries for A6 (brief + the two official docs) to `/docs/master_docs.md` so the registry reflects the new deliverables.
6. Define verification checks (e.g., Prettier dependency present, config files exist, docs mention CI command) so the implementer can confirm completeness.

## Canonical Prettier Files (Root)

**/forgea-monorepo/.prettierrc**

```json
{
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "semi": true,
  "singleQuote": true,
  "trailingComma": "all",
  "bracketSpacing": true,
  "jsxBracketSameLine": false,
  "arrowParens": "always",
  "endOfLine": "lf"
}
```

**/forgea-monorepo/.prettierignore**

```
# Build / output
.next/
out/
dist/
build/
public/assets/

# Dependencies + caches
node_modules/
.turbo/
.cache/
.vscode/
.vercel/
.DS_Store

# Generated artifacts
coverage/
*.min.js
*.bundle.js

# Local temp
tmp/
*.log
```

## Package JSON & Scripts

Add to `/forgea-monorepo/package.json`:

- DevDependency: `prettier` pinned to `3.2.0` (matching the toolchain pin).
- Scripts:
  ```json
  "scripts": {
    "prettier:check": "pnpm -w exec prettier --check \"**/*.{js,ts,tsx,jsx,json,md,css,scss,html}\"",
    "prettier:write": "pnpm -w exec prettier --write \"**/*.{js,ts,tsx,jsx,json,md,css,scss,html}\""
  }
  ```
  Using `pnpm -w exec` ensures the workspace-installed binary executes consistently across CI and local runs.

## CI Guidance & Remediation

CI should run:

```
pnpm install --frozen-lockfile
pnpm -w exec prettier --check "**/*.{js,ts,tsx,jsx,json,md,css,scss,html}"
```

Remediation directions for the CI guide:

1. `pnpm install` (add `--frozen-lockfile` if the lockfile is authoritative).
2. `pnpm -w exec prettier --write "**/*.{js,ts,tsx,jsx,json,md,css,scss,html}"`.
3. Review, stage, and commit the formatted files, then rerun CI. Avoid auto-writing in CI—developers must check in formatting changes themselves.

## Documentation Snippets to Add

**/docs/official-docs/prettier.md**

```markdown
# Prettier — Repository Formatting Authority

**Canonical version:** `3.2.x` (pin exact patch per toolchain policy; repository uses `prettier@3.2.0`).

## Purpose

Prettier is the single formatting authority for the Forgea monorepo. Its configuration and ignored paths are canonical at the repository root.

## Files

- `/forgea-monorepo/.prettierrc` — canonical formatting settings (JSON).
- `/forgea-monorepo/.prettierignore` — files and folders excluded from formatting.

## Key settings (summary)

- printWidth: 100
- tabWidth: 2
- singleQuote: true
- trailingComma: all
- endOfLine: lf

(See `/forgea-monorepo/.prettierrc` for full options.)

## Editor integration

- Recommend installing the Prettier extension for VS Code and enabling "Format on Save".
- Set editor to use project Prettier: the VS Code Prettier extension auto-detects the workspace Prettier binary when the repo has `prettier` in devDependencies.

## Conflicts with ESLint

- Prettier is the sole formatting tool. ESLint should not contain conflicting stylistic rules (see ESLint docs in `/docs/official-docs/eslint-ci-guidelines.md`).
```

**/docs/official-docs/prettier-ci-guidelines.md**

```markdown
# Prettier CI Guidelines

## CI command (recommended)
```

pnpm install --frozen-lockfile
pnpm -w exec prettier --check "\*_/_.{js,ts,tsx,jsx,json,md,css,scss,html}"

```

## Rationale
- `pnpm install --frozen-lockfile` ensures CI uses the exact lockfile.
- `pnpm -w exec` runs the workspace-installed, pinned Prettier binary.

## Remediation (developer steps)
1. `pnpm install`
2. `pnpm -w exec prettier --write "**/*.{js,ts,tsx,jsx,json,md,css,scss,html}"`
3. Review, `git add`, and `git commit`, then push.

## Alternative (if you must avoid installing devDependencies)
- `pnpm -w dlx --package prettier@3.2.0 prettier --check ...` — **not recommended** because it defeats repository pinning and introduces external network fetches.

## Caching / performance notes
- Prettier is CPU-bound; prefer targeting source directories in CI if run-time becomes a problem (e.g., `apps/**/src`, `packages/**/src`).
```

## Master Docs Registry Entry

Append entries for A6 as instructed by the gatekeeper (brief + `/docs/official-docs/prettier.md` + `/docs/official-docs/prettier-ci-guidelines.md`, all reflecting Prettier @3.2.x).

---

## Files Expected to Modify

- forgea-monorepo/package.json (add Prettier dependency and optional formatting scripts).
- forgea-monorepo/.prettierrc or prettier.config.js (canonical config).
- forgea-monorepo/.prettierignore (ignored paths for formatting).
- docs/official-docs/prettier.md (document version pin + config guidance).
- docs/official-docs/prettier-ci-guidelines.md (describe CI enforcement command + remediation).
- docs/master_docs.md (register the gatekeeper brief and the two new docs per instructions).

---

## Verification Criteria (Machine-Checkable)

- Root `package.json` lists `prettier` pinned to 3.2.x in devDependencies.
- `.prettierrc` (or `prettier.config.*`) and `.prettierignore` exist at the repository root.
- /docs/official-docs/prettier.md and /docs/official-docs/prettier-ci-guidelines.md mention the chosen version, canonical config, CI lint command, and remediation steps.
- /docs/master_docs.md contains the A6 entries for the gatekeeper brief and both internal docs.

---

## Risks & Tradeoffs

- Not pinning Prettier or omitting `.prettierrc` will allow tooling to drift between contributors and CI, causing inconsistent formatting.
- Adding conflicting ESLint formatting rules without alignment will create lint vs. format failures; Prettier must remain the sole formatting authority.
- Invoking Prettier via `pnpm -w dlx` may add install overhead, but avoiding a shared devDependency risks binaries being missing in CI.

---

## Dependencies

- Docs Gatekeeper must sign off on the new internal docs (prettier.md, prettier-ci-guidelines.md) before implementation, since they capture the chosen version.
- The shared toolchain policy locks the Prettier version; any deviation would require a policy update.

---
