# Task A3 — Turborepo Setup

Date: 2026-02-06
Status: APPROVED

---

## Goal

Pin Turborepo to the toolchain-approved version and align Turbo configuration, pipeline conventions, and documentation so task orchestration and caching are deterministic.

---

## Docs Gatekeeper Findings (Advisory)

Source: /docs/docs-gatekeeper/EPIC-A — MONOREPO & DEVELOPER TOOLING FOUNDATION/A3_Turborepo Setup.md

- Required official docs: Turborepo schema, configuration, caching, and pipeline behavior (version pin was listed as UNKNOWN in the brief).
- Required internal docs to add/extend: /docs/official-docs/EPIC-A/A3_turborepo_official.md and /docs/official-docs/EPIC-A/turbo_pipeline_guidelines.md.
- Master docs registry updates required for A3 gatekeeper brief and the required internal doc.

Planner note: Registry and toolchain now provide Turborepo 2.1.x pin; this supersedes the gatekeeper “unknown” state.

---

## Documentation Registry Alignment

Source: /docs/official-docs-registry.md

- Turborepo is VERIFIED with primary pin 2.1.x and official sources:
  - https://turborepo.org/docs
  - https://turborepo.org/docs/reference/configuration
  - https://turborepo.org/docs/features/caching
  - https://turborepo.org/schema.json
- Internal docs registered:
  - /docs/official-docs/EPIC-A/A3_turborepo_official.md
  - /docs/official-docs/EPIC-A/turborepo.md
  - /docs/official-docs/EPIC-A/turbo_pipeline_guidelines.md

---

## Toolchain Version Authority

Source: /docs/toolchain-versions.md

- Turborepo primary pin: 2.1.x
- Toolchain document is the single source of truth for tool versions.

---

## Code Scout Facts (Constraints)

Source: /docs/code-scout/EPIC-A — MONOREPO & DEVELOPER TOOLING FOUNDATION/A3_Turborepo Setup.md

- forgea-monorepo/turbo.json exists with tasks: build, dev, lint.
  - build dependsOn: ^build
  - build outputs: [".next/**", "dist/**"]
  - dev: cache false
  - lint: empty object
- forgea-monorepo/package.json:
  - scripts: build/dev/lint invoke `turbo run ...`
  - devDependencies include `turbo: "latest"` (not pinned)
- pnpm-workspace.yaml and package.json workspaces are mismatched (services/\* missing from pnpm-workspace.yaml in the scout report).

---

## Scope (Binding)

### In Scope

- Pin `turbo` version in root devDependencies to the toolchain-approved version.
- Align and document Turbo configuration conventions and pipeline rules per official docs.
- Ensure `turbo.json` tasks and outputs are consistent with policy (including explicit expectations for lint task outputs/dependsOn if required by policy).
- Update master documentation registry entries per Docs Gatekeeper.

### Out of Scope

- Application runtime or business logic changes.
- CI pipeline wiring beyond documentation guidance.
- Workspace membership fixes unrelated to Turborepo (handled by A2).

---

## Locked Decisions (Derived from Documentation)

1. Turborepo version must be pinned to the toolchain policy (2.1.x).
   Source: /docs/toolchain-versions.md

2. `turbo.json` must follow the canonical rules for task mapping, `dependsOn`, and outputs.
   Sources: /docs/official-docs/EPIC-A/turborepo.md, /docs/official-docs/EPIC-A/turbo_pipeline_guidelines.md

---

## Resolved Decisions (User-Approved)

### Remote Cache Policy (Resolved)

- Remote caching is OPTIONAL.
- This repository uses local caching only.
- No remote cache provider is required or configured in EPIC-A.
- Remote cache configuration is deferred to a future Infra/CI epic.

### Lint Task Policy (Resolved)

- lint tasks:
  - MUST have no outputs
  - MUST NOT declare dependsOn
  - MUST set cache: false (explicit or implicit)
- lint exists only to validate source state, not produce artifacts.

---

## Invariants (Must Not Be Violated)

- Build and cache semantics remain deterministic.
- No changes to application runtime behavior.
- Root `turbo.json` remains valid against the official schema.

---

## Step-by-Step Plan (Non-Code)

1. Pin the `turbo` devDependency to the toolchain-approved semver (2.1.x).
2. Update /docs/official-docs/EPIC-A/A3_turborepo_official.md with the pinned version and canonical configuration guidance used by this repo.
3. Update /docs/official-docs/EPIC-A/turbo_pipeline_guidelines.md to reflect the required task conventions (build/dev/lint) and outputs/dependsOn expectations.
4. Ensure `turbo.json` aligns with the documented rules (tasks, outputs, cache settings) without introducing new tasks outside scope.
5. Append required entries to /docs/master_docs.md per Docs Gatekeeper instructions.
6. Define verification checks for version pinning, task mapping, and schema validity.

---

## Files Expected to Modify

- forgea-monorepo/package.json
- forgea-monorepo/turbo.json
- docs/official-docs/EPIC-A/A3_turborepo_official.md
- docs/official-docs/EPIC-A/turbo_pipeline_guidelines.md
- docs/master_docs.md

---

## Files to NOT Touch

- forgea-monorepo/apps/\*\*
- forgea-monorepo/packages/\*\* (excluding manifest updates if required)
- forgea-monorepo/services/\*\*
- forgea-monorepo/infra/\*\*
- forgea-monorepo/packages/schema/prisma/migrations/\*\* (LOCKED)

---

## Verification Criteria (Machine-Checkable)

- Root devDependencies contain `turbo` pinned to 2.1.x.
- `turbo.json` validates against the official schema and matches documented task conventions.
- Required Turborepo docs (A3_turborepo_official and turbo_pipeline_guidelines) explicitly state the pinned version and repo-specific pipeline rules.
- master_docs.md includes the A3 entries required by the Docs Gatekeeper brief.

---

## Risks & Tradeoffs

- Leaving `turbo` as `latest` risks non-reproducible pipelines.
- Ambiguous lint task conventions can lead to inconsistent task graph behavior across packages.

---

## Dependencies

- Blocked by: Remote cache policy decision (if required by governance).
- Unlocks: Deterministic Turbo task execution and versioned pipeline behavior.
