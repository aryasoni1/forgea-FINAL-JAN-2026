---
id: A1
date: 2026-02-27
epic: EPIC-A
title: Repository & Structure
status: APPROVED
source: /docs/code-scout/EPIC-A — MONOREPO & DEVELOPER TOOLING FOUNDATION/A1_Repository & Structure.md
knowledge-architect: /docs/knowledge-architect/EPIC-A — MONOREPO & DEVELOPER TOOLING FOUNDATION/A1_Repository & Structure.md
---

# Task A1 — Repository & Structure

## Goal

Establish a fully aligned, enforceable monorepo workspace configuration with verified boundary enforcement, TypeScript resolution consistency, and repository-level ownership documentation. This task ensures `pnpm-workspace.yaml` and `package.json` workspaces are synchronized, TypeScript paths are correctly resolved across all workspace types, import boundaries prevent cross-app coupling, and repository governance files are in place.

---

## Layer Classification

This task affects:

- [x] Infrastructure / External Systems
- [ ] Database Layer
- [ ] Application Service Layer
- [ ] API Layer
- [ ] Frontend/UI Layer
- [x] Documentation Only

**Justification:** This task spans infrastructure tooling (workspace config, build orchestration) and documentation (README, CONTRIBUTING, CODEOWNERS). These are foundational concerns that cannot be split—workspace configuration is atomic and must be aligned across all package manager and build tool configurations simultaneously.

---

## Cross-Epic Impact

**No cross-epic impact.**

This task establishes foundational monorepo structure and tooling boundaries. All future EPICs will consume this structure but do not require coordination at this stage.

---

## Migration Risk Level

**LOW — additive only**

All changes are additive configuration updates and new documentation files. No existing code logic is modified. The only behavioral change is enforcement of import boundaries via ESLint, which will flag violations but not break existing runtime behavior.

---

## Scope (Binding)

### In Scope

1. **Workspace Alignment:**
   - Add `services/*` to `pnpm-workspace.yaml` to match `package.json` workspaces array
   - Document alignment decision in `/docs/official-docs/pnpm-workspaces.md`

2. **TypeScript Configuration:**
   - Decide whether to add `apps/` to root `tsconfig.json` include array
   - Document TypeScript Project References strategy in `/docs/official-docs/tsconfig.md`

3. **Import Boundary Enforcement:**
   - Install and configure `eslint-plugin-boundaries`
   - Define architectural elements for `apps/*`, `packages/*`, `services/*`
   - Configure rules to block cross-app imports while allowing shared package imports
   - Document enforcement strategy in `/docs/official-docs/eslint-boundaries.md`

4. **Repository Governance:**
   - Create root-level `README.md` with repository overview
   - Create `CONTRIBUTING.md` with developer onboarding and contribution guidelines
   - Create `CODEOWNERS` file with ownership patterns
   - Document boundary policies in `/docs/official-docs/repo-boundaries.md`

5. **CI Verification:**
   - Document machine-checkable verification steps in task deliverables
   - Ensure `pnpm ls -r --depth -1` validates workspace discovery
   - Ensure `turbo ls` validates Turborepo package graph
   - Ensure `pnpm run lint` enforces boundary rules

### Out of Scope

- Modification of existing package source code
- Changes to database migrations under `packages/schema/prisma/migrations/` (LOCKED)
- Implementation of pre-commit hooks (future task)
- CI pipeline implementation (future task)
- Turborepo remote caching configuration (future task)

---

## Documentation & Truth Intake

### Verified Implementation Truth (Primary)

- [x] `/docs/knowledge-architect/EPIC-A — MONOREPO & DEVELOPER TOOLING FOUNDATION/A1_Repository & Structure.md`
- [x] `/docs/technology/docs-tech-notebooklm/divison_ques/07-devops-ci-cd-infra-tooling.md`
- [x] `/docs/technology/docs-tech-notebooklm/divison_ques/08-code-language-tooling-linters.md`

### Toolchain Status

- [x] `/docs/toolchain-versions.md`

**Note:** Version pins from `toolchain-versions.md` are used only where explicitly approved by Knowledge-Architect answers. Specific approvals documented below.

### Missing Truths / Knowledge Gaps

**NONE.** All required questions for Feature A1 have been answered in the Knowledge-Architect study guide:

- ✅ pnpm workspace YAML schema and CLI validation commands
- ✅ ESLint boundary enforcement plugin and configuration
- ✅ TypeScript `include` vs `references` strategy for monorepos
- ✅ Turborepo package discovery and verification commands
- ✅ CI enforcement mechanisms and fail-fast strategies

---

## Code Scout Correlation (Facts Only)

### What Exists

- `pnpm-workspace.yaml` with `apps/*` and `packages/*` defined
- `package.json` workspaces array with `apps/*`, `packages/*`, and `services/*`
- Root `tsconfig.json` with `baseUrl` and `paths` for internal packages
- `tsconfig.json` includes `packages/**/*` and `services/**/*` but NOT `apps/`
- Comprehensive `.gitignore` for Node, Turborepo, builds, env files
- `turbo.json` with task definitions
- Three populated directories: `apps/` (4 apps), `packages/` (6 packages), `services/` (3 services)
- Active database migrations under `packages/schema/prisma/migrations/`

### What is Missing

- `services/*` is absent from `pnpm-workspace.yaml` (divergence from `package.json`)
- No root-level `README.md` at `/forgea-monorepo/README.md`
- No `CONTRIBUTING.md` for developer onboarding
- No `CODEOWNERS` file for ownership tracking
- No ESLint boundary enforcement configuration
- No official documentation files for workspace, tsconfig, or boundary decisions

### What Must Change

- `pnpm-workspace.yaml` must add `services/*` to packages array
- Root `tsconfig.json` decision required: add `apps/` to include or document Project References approach
- ESLint configuration must include `eslint-plugin-boundaries` with architectural element definitions
- Four new governance files must be created: README, CONTRIBUTING, CODEOWNERS, and official docs

---

## Preconditions

### Dependencies (Internal/External)

- **pnpm v10.x** must be installed and pinned via `packageManager` field [VERIFIED in Knowledge-Architect]
- **Turborepo v2.x** must be installed as devDependency [VERIFIED in toolchain-versions.md]
- **ESLint v9.x or v10.x** must be installed (flat config format) [ASSUMED from Knowledge-Architect examples]
- Node.js v20.x must be active runtime [VERIFIED in toolchain-versions.md]

### Required Previous Tasks

**NONE.** This is the foundational task for EPIC-A.

### Required Environment State

- Clean working directory (no uncommitted changes to workspace config files)
- `pnpm install` must complete successfully before and after changes
- All existing packages must have valid `package.json` files

---

## Locked Decisions (Derived from Manual Build Truth)

### Decision 1: Include `services/*` in `pnpm-workspace.yaml`

**Source:** [KNOWLEDGE-ARCHITECT A1 → DevOps Beginner Answer #1]

> "Yes, you should include `"services/*"` in your `pnpm-workspace.yaml` file. Because pnpm dictates its workspace structure exclusively through `pnpm-workspace.yaml`, it will ignore the `workspaces` array in your `package.json`."

**Implementation:** Add `- "services/*"` to the `packages` array in `pnpm-workspace.yaml`.

**Rejection Note:** The draft `toolchain-versions.md` was silent on this workspace divergence. The Knowledge-Architect answer provides explicit, documentation-backed guidance that pnpm requires explicit listing.

---

### Decision 2: Use `pnpm ls -r --depth -1` and `turbo ls` for Workspace Verification

**Source:** [KNOWLEDGE-ARCHITECT A1 → DevOps Beginner Answer #2]

> "To check if your workspace packages are correctly recognized by pnpm, you can use `pnpm ls -r --depth -1`. If you are using Turborepo, you can use `turbo ls` to print a list of all the packages."

**Implementation:** Document these commands as machine-checkable verification criteria.

---

### Decision 3: Enable pnpm Strictness Settings for CI Enforcement

**Source:** [KNOWLEDGE-ARCHITECT A1 → DevOps Senior Answer #1]

> "Set `packageManagerStrictVersion: true` to force CI to fail if the pnpm version doesn't match. Enable `disallowWorkspaceCycles: true` and `strictPeerDependencies: true`."

**Implementation:** Document these settings as required CI configuration (implementation in future CI task).

**Version Pin:** pnpm v10.29.0 [APPROVED via KA: DevOps Answer #1 + toolchain-versions.md alignment]

---

### Decision 4: Use `eslint-plugin-boundaries` for Import Boundary Enforcement

**Source:** [KNOWLEDGE-ARCHITECT A1 → Code/Language Beginner Answer #1]

> "The recommended plugin for enforcing import boundaries is **`eslint-plugin-boundaries`**. This plugin helps maintain a clean architecture in JavaScript and TypeScript projects by allowing you to define architectural elements (like layers) and specify dependency rules."

**Implementation:** Install `eslint-plugin-boundaries` and configure with:

- Element type `app` matching `apps/*`
- Element type `package` matching `packages/*`
- Element type `service` matching `services/*` (optional, aligned with workspace structure)
- Default rule: `"disallow"`
- Allow rule: `app` can import from `package`
- Allow rule: `package` can import from `package`
- Block: `app` cannot import from other `app`

---

### Decision 5: TypeScript Project References Strategy (Not Paths)

**Source:** [KNOWLEDGE-ARCHITECT A1 → Code/Language Intermediate Answer #1]

> "The most important rule: **you should not use the `paths` option to artificially resolve packages in a monorepo**. Instead, you should structure your repository using **package manager workspaces** alongside **TypeScript Project References**."

**Implementation:** Use solution-style root `tsconfig.json` with:

- Empty `files` array (prevents double-compilation)
- `references` array pointing to individual project `tsconfig.json` files
- Each sub-project must have `composite: true` if referenced by others

**Decision on `apps/` inclusion:** Document that `apps/` should NOT be in root `include` array. Instead, each app should have its own `tsconfig.json` with local `include` scoping and `references` to shared packages.

---

### Decision 6: ESLint Rule Severity Must Be "Error" for Fail-Closed Enforcement

**Source:** [KNOWLEDGE-ARCHITECT A1 → Code/Language Intermediate Answer #2]

> "The foundational invariant is that your `eslint-plugin-boundaries` rules **must be configured with a severity of `"error"` (or `2`)**. ESLint is designed to exit with a non-zero status code if and only if a rule configured as an `"error"` is triggered."

**Implementation:** Set `boundaries/element-types` rule severity to `2` (error).

---

### Decision 7: Disable Inline ESLint Configuration for HARD LOCK Zones

**Source:** [KNOWLEDGE-ARCHITECT A1 → Code/Language Senior Answer #2]

> "You can completely prevent developers from using inline comments like `/* eslint-disable */` by setting `noInlineConfig: true` in your `linterOptions`."

**Implementation:** Configure `noInlineConfig: true` in `eslint.config.js` linterOptions (document for future implementation; not enforced in this task unless explicitly required).

---

## Invariants (Must Not Be Violated)

1. **Workspace Alignment Invariant:** `pnpm-workspace.yaml` packages array MUST match `package.json` workspaces array. Any divergence causes unpredictable package discovery.

2. **Boundary Enforcement Invariant:** No code in `apps/*` may import from other apps. Cross-app imports MUST trigger ESLint error (exit code 1).

3. **TypeScript Path Resolution Invariant:** The `paths` compiler option MUST NOT be used to resolve workspace packages. All package resolution MUST occur via package manager workspace symlinks.

4. **Immutability Trigger Preservation:** All existing database migrations under `packages/schema/prisma/migrations/` MUST remain untouched. These are HARD LOCK zones.

5. **Package Manager Lock Invariant:** The `packageManager` field in root `package.json` MUST specify exact pnpm version. CI MUST fail if version drifts.

6. **Turborepo Graph Consistency:** Turborepo MUST be able to construct a valid Package Graph from the workspace. The graph MUST NOT contain cycles.

---

## Step-by-Step Plan (Non-Code)

### Step 1: Align Workspace Configuration

**Source:** [KA: DevOps Beginner #1]

1.1. Open `pnpm-workspace.yaml`
1.2. Add `- "services/*"` to the `packages` array
1.3. Verify alignment with `package.json` workspaces array
1.4. Run `pnpm install` to regenerate lockfile with new workspace structure
1.5. Run `pnpm ls -r --depth -1` to verify all 13 packages are discovered (4 apps + 6 packages + 3 services)

### Step 2: Document Workspace Decision

**Source:** [KA: DevOps Beginner #1]

2.1. Create `/docs/official-docs/pnpm-workspaces.md`
2.2. Document the requirement that `pnpm-workspace.yaml` must explicitly list all workspace directories
2.3. Document the verification command: `pnpm ls -r --depth -1`
2.4. Document the CI enforcement requirement: `--frozen-lockfile` in CI environments

### Step 3: Document TypeScript Strategy

**Source:** [KA: Code/Language Intermediate #1]

3.1. Create `/docs/official-docs/tsconfig.md`
3.2. Document the solution-style root `tsconfig.json` approach
3.3. Document that `apps/` are intentionally excluded from root `include`
3.4. Document that each app/package/service should have individual `tsconfig.json` with `composite: true`
3.5. Document that `paths` must NOT be used for workspace package resolution

### Step 4: Install ESLint Boundary Plugin

**Source:** [KA: Code/Language Beginner #1]

4.1. Run `pnpm add -Dw eslint-plugin-boundaries` to install at workspace root
4.2. Verify installation in root `package.json` devDependencies

### Step 5: Configure ESLint Boundaries

**Source:** [KA: Code/Language Beginner #1 + #2]

5.1. Open `forgea-monorepo/eslint.config.js`
5.2. Import `eslint-plugin-boundaries`
5.3. Add `boundaries` to plugins object
5.4. Add `boundaries/elements` settings with three element types: `app` (`apps/*`), `package` (`packages/*`), `service` (`services/*`)
5.5. Add `boundaries/element-types` rule with severity `2` (error)
5.6. Configure default: `"disallow"`
5.7. Configure allow rules: `app` → `package`, `package` → `package`, `service` → `package`
5.8. Implicit block: `app` cannot import from `app`, `app` cannot import from `service`, `service` cannot import from `app`

### Step 6: Document ESLint Boundary Strategy

**Source:** [KA: Code/Language Intermediate #2]

6.1. Create `/docs/official-docs/eslint-boundaries.md`
6.2. Document the architectural elements and their directory patterns
6.3. Document the allowed and disallowed import relationships
6.4. Document the verification command: `pnpm run lint` (assumes lint script exists)
6.5. Document the CI enforcement requirement: ESLint exit code 1 on boundary violations
6.6. Document the fail-closed requirement: rule severity must be `"error"` (or `2`)

### Step 7: Create Repository Governance Files

**Source:** [Code Scout: Missing Items]

7.1. Create `/forgea-monorepo/README.md` with:

- Repository name and purpose
- High-level architecture overview (monorepo with apps/packages/services)
- Quick start instructions (pnpm install, build commands)
- Link to CONTRIBUTING.md

  7.2. Create `/forgea-monorepo/CONTRIBUTING.md` with:

- Developer setup instructions
- Workspace verification commands
- Commit message conventions
- Pull request guidelines
- Link to boundary enforcement documentation

  7.3. Create `/forgea-monorepo/CODEOWNERS` with:

- Ownership patterns for `apps/*`, `packages/*`, `services/*`
- Placeholder team assignments (e.g., `@forgea/platform-team`)
- Special ownership for `packages/schema/prisma/migrations/*` (HARD LOCK)

### Step 8: Document Repository Boundary Policies

**Source:** [Code Scout: Missing Items]

8.1. Create `/docs/official-docs/repo-boundaries.md`
8.2. Document the "no cross-app imports" policy
8.3. Document allowed import patterns: `apps → packages`, `services → packages`, `packages → packages`
8.4. Document disallowed import patterns: `apps → apps`, `apps → services`, `services → apps`
8.5. Document the enforcement mechanism: `eslint-plugin-boundaries`
8.6. Document the verification workflow: pre-commit (future), CI (future)

### Step 9: Verify Workspace Consistency

**Source:** [KA: DevOps Beginner #2]

9.1. Run `pnpm ls -r --depth -1` and verify 13 packages listed
9.2. Run `turbo ls` and verify all packages discovered by Turborepo
9.3. Verify no error output from either command

### Step 10: Verify Boundary Enforcement

**Source:** [KA: Code/Language Intermediate #2]

10.1. Run `pnpm run lint` (or `npx eslint .`) to execute ESLint
10.2. Verify no existing cross-app imports are flagged (if violations exist, document as follow-up task)
10.3. Verify ESLint exit code is 0 (success)

---

## Deliverables

1. **Updated `pnpm-workspace.yaml`** with `services/*` included
2. **Root `README.md`** with repository overview and quick start
3. **Root `CONTRIBUTING.md`** with developer guidelines
4. **Root `CODEOWNERS`** with ownership patterns
5. **`/docs/official-docs/pnpm-workspaces.md`** documenting workspace configuration
6. **`/docs/official-docs/tsconfig.md`** documenting TypeScript Project References strategy
7. **`/docs/official-docs/eslint-boundaries.md`** documenting import boundary enforcement
8. **`/docs/official-docs/repo-boundaries.md`** documenting repository boundary policies
9. **Updated `eslint.config.js`** with `eslint-plugin-boundaries` configuration
10. **This task document** at `/docs/tasks/EPIC-A/task-A1-2026-02-27.md`

---

## Files Expected to Modify

- `/forgea-monorepo/pnpm-workspace.yaml`
- `/forgea-monorepo/eslint.config.js`
- `/forgea-monorepo/package.json` (devDependencies for eslint-plugin-boundaries)

---

## Files to Create

- `/forgea-monorepo/README.md`
- `/forgea-monorepo/CONTRIBUTING.md`
- `/forgea-monorepo/CODEOWNERS`
- `/docs/official-docs/pnpm-workspaces.md`
- `/docs/official-docs/tsconfig.md`
- `/docs/official-docs/eslint-boundaries.md`
- `/docs/official-docs/repo-boundaries.md`

---

## Files to NOT Touch

- `/forgea-monorepo/packages/schema/prisma/migrations/**/*` (HARD LOCK — immutability triggers)
- `/forgea-monorepo/turbo.json` (out of scope for this task)
- `/forgea-monorepo/tsconfig.json` (no modifications; only documentation of strategy)
- Any source code files in `apps/*`, `packages/*`, `services/*` (boundary enforcement only; no refactoring)

---

## Verification Criteria (Machine-Checkable)

1. **Workspace Discovery:**
   - ✅ `pnpm ls -r --depth -1` returns 13 packages (4 apps + 6 packages + 3 services)
   - ✅ `turbo ls` returns matching package list

2. **Workspace Alignment:**
   - ✅ `pnpm-workspace.yaml` contains `- "services/*"`
   - ✅ `grep -q '"services/\*"' pnpm-workspace.yaml` exits with code 0

3. **Boundary Enforcement:**
   - ✅ `pnpm run lint` (or `npx eslint .`) exits with code 0 (no violations)
   - ✅ `eslint.config.js` contains `eslint-plugin-boundaries` import and configuration
   - ✅ Rule severity for `boundaries/element-types` is `2` (error)

4. **Documentation Completeness:**
   - ✅ `test -f forgea-monorepo/README.md` exits with code 0
   - ✅ `test -f forgea-monorepo/CONTRIBUTING.md` exits with code 0
   - ✅ `test -f forgea-monorepo/CODEOWNERS` exits with code 0
   - ✅ `test -f docs/official-docs/pnpm-workspaces.md` exits with code 0
   - ✅ `test -f docs/official-docs/tsconfig.md` exits with code 0
   - ✅ `test -f docs/official-docs/eslint-boundaries.md` exits with code 0
   - ✅ `test -f docs/official-docs/repo-boundaries.md` exits with code 0

5. **Package Manager Lock:**
   - ✅ `grep -q '"packageManager": "pnpm@' forgea-monorepo/package.json` exits with code 0
   - ✅ Version matches Knowledge-Architect approved version (10.29.0)

6. **Plugin Installation:**
   - ✅ `grep -q 'eslint-plugin-boundaries' forgea-monorepo/package.json` exits with code 0

---

## Risks & Tradeoffs

### Risk 1: Existing Cross-App Imports May Exist

**Likelihood:** Medium
**Impact:** Medium
**Mitigation:** Run `pnpm run lint` after configuration. If violations exist, create follow-up task to refactor imports. Do NOT disable boundary rules to pass lint.

### Risk 2: TypeScript Editor Experience May Change

**Likelihood:** Low
**Impact:** Low
**Mitigation:** Project References strategy is the recommended approach per TypeScript documentation. If developers experience path resolution issues, ensure each app has correct `references` array in local `tsconfig.json`.

### Risk 3: pnpm Lockfile Regeneration

**Likelihood:** High (expected)
**Impact:** Low
**Mitigation:** Adding `services/*` to workspace will regenerate `pnpm-lock.yaml`. This is expected and correct behavior. Commit the updated lockfile.

### Tradeoff: Manual Build Complexity

**Decision:** Use TypeScript Project References instead of `paths` compiler option.
**Rationale:** Project References are the officially documented approach for monorepos. While `paths` appears simpler, it overrides package.json resolution features and causes runtime failures. The Knowledge-Architect answer explicitly prohibits `paths` for workspace package resolution.

---

## Dependencies

### Blocked By

**NONE.** This is the foundational task for EPIC-A.

### Unlocks

- **A2:** Developer tooling setup (depends on workspace structure)
- **A3:** CI/CD pipeline configuration (depends on verification commands)
- **A4:** Pre-commit hooks (depends on lint configuration)
- **All EPIC-B through EPIC-O tasks:** All future work depends on correct workspace structure and boundary enforcement

---

## Agent Assignments

- **Implementer:** Execute Steps 1-10 verbatim; create all deliverables
- **QA:** Verify all machine-checkable criteria pass
- **Documenter:** (Not required; implementation includes all documentation)

---

## Approval Required

Planner has produced the authoritative task plan.

Please respond with:

- ✅ **Planner approved** — Proceed to implementation
- ✏️ **Requested changes** — Specify modifications required

---

**END OF TASK DOCUMENT**
