# Task A10 — Documentation & Architecture

Date: 2026-02-06
Status: APPROVED

---

## Goal

Clarify the authoritative monorepo architecture guidance by ensuring the Turborepo core document explicitly captures the pinned `turbo` semver, schema URL, remote-cache expectations, and any CI image guidance, and then record that extension in the master documentation registry so future planners have an unambiguous reference.

---

## Docs Gatekeeper Findings (Advisory)

Source: /docs/docs-gatekeeper/EPIC-A — MONOREPO & DEVELOPER TOOLING FOUNDATION/A10_Documentation & Architecture.md

- The official Turborepo doc must describe the exact `turbo` semver to pin, the schema URL used for validation, and how caching/CI should behave (including recommended remote cache choices and image tags). Without that clarity planning and cache sharing across environments is blocked.
- `/docs/master_docs.md` needs a new entry explaining that `/docs/official-docs/EPIC-A/turborepo.md` was extended to include the pinned version/schema/CI guidance so implementers know what to follow.
- Currently the doc is flagged as PARTIAL for version pinning and remote-cache guidance; the gatekeeper requires those gaps to be closed before implementation.

---

## Documentation Registry Alignment

Source: /docs/official-docs-registry.md

- Turborepo is recorded with version 2.x (primary pin 2.1.x) and lists `/docs/official-docs/EPIC-A/turborepo.md` as an authoritative internal doc; the registry assumes a pin even though the current doc text is vague about the exact semver.
- No additional registry entries are needed for pnpm or TypeScript for this feature—they are already marked VERIFIED and not part of the gap.

---

## Toolchain Version Authority

Source: /docs/toolchain-versions.md

- Turborepo must be pinned to 2.1.x (`"turbo": "2.1.x"` in devDependencies) and may only upgrade to a newer minor/major after policy review.
- This policy is the single source of truth for the version we document in `/docs/official-docs/EPIC-A/turborepo.md`, so the doc must refer to 2.1.x (or another user-approved semver within the allowed range).

---

## Code Scout Facts (Constraints)

Source: /docs/code-scout/EPIC-A — MONOREPO & DEVELOPER TOOLING FOUNDATION/A10_Documentation & Architecture.md

- Existing documentation already covers pnpm and TypeScript tooling decisions; only Turborepo coverage is partial (version is unknown in the doc, and the repo currently depends on `turbo: "latest"`).
- The repo does have `turbo.json` configured, so any documentation changes must reflect the actual, current pipeline semantics (outputs, strict mode, env handling) recorded in the other Turborepo docs.
- No other architecture notes or folder-conventions updates are required for this feature—planning is limited to improving Turborepo documentation and its registry entry.

---

## Scope (Binding)

### In Scope

- Confirm the authorial intent of `/docs/official-docs/EPIC-A/turborepo.md` and identify where to insert explicit references to the pinned `turbo` semver and schema URL.
- Document how caching should behave (local vs remote), recommend a remote cache provider (if any), and specify any CI image/tag expectations that rely on `turbo`.
- Record the doc extension in `/docs/master_docs.md` per the gatekeeper brief so future planners know the dependency has been satisfied.
- Surface the need for user input where version or caching decisions remain unresolved.

### Out of Scope

- Changing package manifests (`package.json`, `turbo.json`) or runtime behavior to pin `turbo`; this task is documentation-only.
- Implementing remote caching infrastructure or altering CI scripts; documentation may reference configuration but must not modify executing pipelines.
- Updating pnpm, TypeScript, or other tooling docs outside the Turborepo focus for this task.

---

## Locked Decisions (Derived from Documentation)

1. A root-level `turbo.json` is required, and every task entry must map to a script defined in `package.json` (Source: /docs/official-docs/EPIC-A/turborepo.md).
2. Tasks that produce artifacts must declare `outputs`, `env`/`globalEnv` must list every environment variable used, and `dependsOn` semantics (`^`, local, arbitrary) are enforced exactly as described in `/docs/official-docs/EPIC-A/turbo_pipeline_guidelines.md`.
3. Turborepo upgrades must respect the toolchain policy pin of 2.1.x (Source: /docs/toolchain-versions.md); the documentation has to call out that specific semver (or another user-approved semver within `>=2.0.0 <3.0.0`).
4. Remote caching is optional by policy and unspecified providers must not be assumed; any guidance we add to the doc should either describe the current local-only stance or explicitly document the approved provider provided by the user (Source: /docs/official-docs/EPIC-A/turborepo.md and the gatekeeper brief).

---

## Resolved Decisions (User-Provided)

- Turborepo is pinned to the 2.1.x release line (e.g., ^2.1.0); any upgrade outside >=2.0.0 <3.0.0 must follow policy review. Document this exact range in the Turborepo guidance. (Source: /docs/toolchain-versions.md & /docs/official-docs-registry.md)
- Turborepo remote caching is optional; Forgea currently relies on the local cache only, and no provider is required or assumed by default. Mention that Vercel or self-hosted options may be added later but are not obligated today. (Source: gatekeeper advisory + absence of existing provider doc)
- CI must use a Node.js 20.x image compatible with Turbo 2.1.x; no special Turbo Docker image is necessary. (Source: node policy + Turbo running as Node binary)

---

## Invariants (Must Not Be Violated)

- All documentation must trace back to an official doc or the registry; no new architecture decisions without a cited source.
- The Turborepo doc must not contradict the toolchain policy (2.1.x) or the canonical pipeline guidelines when describing outputs, env handling, and caching.
- No code/config changes are introduced in this phase—only docs.
- Records of the doc change (master docs entry) must exist before implementation.

---

## Open Questions (Must Be Resolved)

- None; all clarifications have been provided.

---

## Step-by-Step Plan (Non-Code)

1. Review `/docs/official-docs/EPIC-A/turborepo.md` to identify where version, schema, and caching guidance currently live and note the missing sections documented by the gatekeeper (explicit semver, schema URL, remote cache/CI notes).
2. Draft the doc extension: add a clear "Version & Compatibility" subsection that names the pinned `turbo` release (2.1.x) plus the schema URL (`https://turborepo.org/schema.json` or the versioned mirror), and note that any upgrades outside the 2.x line require policy review. Expand the caching section to confirm Turborepo is local-only today and mention potential future providers.
3. Explicitly document CI expectations: Node.js 20.x images compatible with Turbo 2.1.x are required, no Turbo-specific Docker image is needed, and reference strict mode requirements so implementers know to capture `outputs` and `env`/`globalEnv` details.
4. Append an entry to `/docs/master_docs.md` noting the doc extension date, feature (A10), and why the doc change is required (pinning `turbo`, schema, caching/CI guidance) so downstream agents know the requirement is satisfied.
5. Verify the new text anti-cipates compliance with the gatekeeper requirements; confirm there are no inconsistent statements with `/docs/toolchain-versions.md` or the pipeline docs.

---

## Files Expected to Modify

- /docs/official-docs/EPIC-A/turborepo.md
- /docs/master_docs.md (to record that the doc was extended to cover the gating requirements)

---

## Files to NOT Touch

- forgea-monorepo/package.json
- forgea-monorepo/turbo.json
- Any application, package, or service source code (apps/**, packages/**, services/\*\*)
- CI pipeline scripts and infrastructure files (infra/\*\*)

---

## Verification Criteria (Machine-Checkable)

- The Turborepo doc clearly states the pinned `turbo` version (with a semver within 2.x) and references the schema URL used for validation.
- The doc now includes a remote-cache/CI section that describes the chosen provider (or local-only stance) plus any required image/tag details.
- `/docs/master_docs.md` has a new entry (dated 2026-02-06) documenting that Turborepo guidance now covers version pinning/schema/remote-cache and referencing Feature A10.
- The updated text does not conflict with the existing tooling constraints (strict env mode, `outputs`, `dependsOn` semantics) described elsewhere.

---

## Risks & Tradeoffs

- If we document the wrong `turbo` semver, future implementers may pin an unsupported version or drift from the toolchain policy.
- Documenting remote cache guidance without a provider could imply a commitment to infrastructure that does not exist; keeping the guidance optional requires additional clarity from the user.
- Rushing the doc change without master doc traceability could leave implementers uncertain whether the gatekeeper requirement was met.

---

## Dependencies

- Blocked by: User confirmation of the exact `turbo` version to pin, remote cache provider (if any), and any CI image/tag requirements.
- Unlocks: Clear, versioned Turborepo architecture guidance that downstream implementers can follow without requesting clarification.
