# Task A1 — Repository & Structure

Date: 2026-02-05
Status: APPROVED

---

## Goal

Establish a clear, consistent monorepo structure and governance baseline by aligning workspace discovery, documenting repository entry points, and defining enforceable ownership and import-boundary rules without changing application behavior.

---

## Scope (Binding)

### In Scope

- Align workspace discovery between root `package.json` and `pnpm-workspace.yaml` (apps/packages/services).
- Decide and document whether `apps/` are included in root `tsconfig.json` `include` (or intentionally excluded).
- Add repository entry documentation (README and contributing guidance) at the monorepo root.
- Define CODEOWNERS placement and ownership rules.
- Specify tooling approach to enforce import-boundary rules (ESLint boundaries plugin) and scope it to the correct directories.

### Out of Scope

- Any schema or migration changes.
- Refactors inside application or package code unrelated to repository structure/ownership.
- Changes to runtime behavior or business logic.
- CI pipeline changes beyond those required to validate boundary enforcement.

---

## Preconditions

- Docs Gatekeeper inputs reviewed for A1.
- Toolchain versions are sourced from `/docs/toolchain-versions.md`.
- Official docs registry consulted (`/docs/official-docs-registry.md`).
- Code Scout findings for A1 incorporated.

---

## Assumptions (Explicit)

- Decisions resolved by user and recorded below.

---

## Locked Decisions (Derived from Documentation)

- Workspace root MUST be defined by `pnpm-workspace.yaml` in the repository root. (Source: /docs/official-docs/EPIC-A/pnpm-workspaces.md)
- Internal dependencies MUST use the `workspace:` protocol for local resolution. (Source: /docs/official-docs/EPIC-A/pnpm-workspace-policy.md)
- ESLint MUST use Flat Config (`eslint.config.js`) and rule scopes MUST be explicit via `files` globs. (Source: /docs/official-docs/EPIC-A/eslint-boundaries.md)
- CODEOWNERS file precedence is `.github/CODEOWNERS` → root `CODEOWNERS` → `docs/CODEOWNERS`; last matching rule wins. (Source: /docs/official-docs/EPIC-A/repo-boundaries.md)
- `.gitignore` MUST exist at repo root and include required Node/Turbo/env patterns (e.g., `node_modules/`, `.turbo`, `.env*`). (Source: /docs/official-docs/EPIC-A/git-and-gitignore.md)
- `tsconfig.json` inheritance and `include` semantics: `include` overwrites base config and is relative to the config file. (Source: /docs/official-docs/EPIC-A/typescript-tsconfig-guidelines.md)

## Resolved Decisions (User-Provided)

- `services/*` MUST be included in `pnpm-workspace.yaml` alongside `apps/*` and `packages/*`.
- `apps/` MUST NOT be included in root `tsconfig.json`; each app MUST use its own tsconfig extending a shared base.
- CODEOWNERS MUST live in `.github/CODEOWNERS`, with explicit ownership per top-level directory.
- Import boundaries MUST enforce:
  - apps → packages only
  - services → packages only
  - no cross-app, app↔service, or package→app/service imports
  - documented, minimal exceptions only.

---

## Invariants (Must Not Be Violated)

- Repository structure remains a pnpm + Turborepo monorepo.
- Workspace membership is deterministic and documented.
- Ownership rules are explicit and enforceable via CODEOWNERS.
- Import-boundary enforcement is deterministic and scoped to intended directories.

---

## Step-by-Step Plan (Non-Code)

1. Confirm the intended workspace membership (apps/packages/services) and resolve the current mismatch between `package.json` workspaces and `pnpm-workspace.yaml`.
2. Decide whether root `tsconfig.json` should include `apps/` or rely on per-app configs; document the decision and the rationale.
3. Draft repository-level README and CONTRIBUTING guidance focused on monorepo structure, install/build commands, and contribution rules.
4. Choose CODEOWNERS location per precedence rules, define ownership coverage for top-level areas (apps/, packages/, services/, infra/, docs/), and document required owners.
5. Select the exact import-boundary ruleset using `eslint-plugin-boundaries` and define which directory groups are isolated and which exceptions (if any) are allowed.
6. Specify verification steps to ensure workspace alignment, README/CONTRIBUTING presence, CODEOWNERS validity, and boundary rule enforcement.

---

## Files Expected to Modify

- forgea-monorepo/pnpm-workspace.yaml
- forgea-monorepo/package.json (only if alignment requires changes here)
- forgea-monorepo/tsconfig.json
- forgea-monorepo/README.md
- forgea-monorepo/CONTRIBUTING.md
- forgea-monorepo/.github/CODEOWNERS or forgea-monorepo/CODEOWNERS (choose one)
- forgea-monorepo/eslint.config.js (or other root ESLint Flat Config file, if boundary rules are added)

---

## Files to NOT Touch

- forgea-monorepo/packages/schema/prisma/migrations/\*\* (LOCKED)
- forgea-monorepo/infra/\*\*
- forgea-monorepo/apps/\*\* (no code changes; only boundary rules may reference paths)
- forgea-monorepo/services/\*\* (no code changes; only boundary rules may reference paths)

---

## Verification Criteria (Machine-Checkable)

- `pnpm-workspace.yaml` and `package.json` workspace lists are aligned for all intended workspace directories.
- Root README and CONTRIBUTING exist at the monorepo root.
- A CODEOWNERS file exists in a valid precedence location and contains no prohibited syntax (`!`, `[]`).
- Boundary enforcement rules exist in ESLint Flat Config and fail on cross-boundary imports per the defined policy.
- `tsconfig.json` `include` decision is implemented and documented.

---

## Risks & Tradeoffs

- Tooling alignment changes can disrupt installs if workspace membership is modified without updating internal dependencies.
- Boundary rules may initially fail existing imports if current usage violates intended policy.
- Internal docs show version ambiguity for Git and TypeScript guidance while the registry marks them as verified; this should be reconciled to avoid policy drift.

---

## Open Questions (Must Be Resolved)

- None.

---

## Dependencies

- Blocked by: Decisions in Open Questions.
- Unlocks: Consistent workspace installs, enforceable repo boundaries, and clear contribution guidance.
